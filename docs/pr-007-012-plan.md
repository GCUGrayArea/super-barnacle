# PR-007 through PR-012 Detailed Planning

**Generated:** 2025-11-15
**Status:** All 6 PRs Ready to Start in Parallel
**Purpose:** Detailed planning for Block 3: SkyFi API Client Implementation (PRs 007-012)

---

## âœ… Parallelization Analysis

**CONCLUSION: All 6 PRs (007-012) can run in PARALLEL with ZERO file conflicts! ðŸŽ‰**

### File Conflict Matrix

| File/Directory | PR-007 | PR-008 | PR-009 | PR-010 | PR-011 | PR-012 |
|---|---|---|---|---|---|---|
| src/skyfi/archives.ts | âœ… CREATE | - | - | - | - | - |
| src/skyfi/orders.ts | - | âœ… CREATE | - | - | - | - |
| src/skyfi/feasibility.ts | - | - | âœ… CREATE | - | - | - |
| src/skyfi/order-management.ts | - | - | - | âœ… CREATE | - | - |
| src/skyfi/notifications.ts | - | - | - | - | âœ… CREATE | - |
| src/skyfi/pricing.ts | - | - | - | - | - | âœ… CREATE |
| src/types/ | archives.ts | orders.ts | feasibility.ts | order-status.ts | notifications.ts | pricing.ts |
| src/schemas/ | archives.schemas.ts | orders.schemas.ts | feasibility.schemas.ts | order-management.schemas.ts | notifications.schemas.ts | pricing.schemas.ts |
| src/lib/ | - | delivery-validator.ts | - | - | - | pricing-calculator.ts |

**Analysis:**
- âœ… **Zero file conflicts** - each PR creates different files
- âœ… **Zero logic conflicts** - completely independent functionality
- âœ… All depend on PR-005 (SkyFi Client) and PR-006 (Types) - both complete
- âœ… Can be developed, tested, and committed independently
- âœ… All follow same pattern: client wrapper methods + tests

**File Conflict Count: 0** âœ…

---

## ðŸ“‹ PR-007: Archive Search Implementation

### Overview
**Status:** READY TO START - UNBLOCKED âœ…
**Dependencies:** PR-005 âœ…, PR-006 âœ… (both complete)
**Priority:** High
**Estimated Time:** 45-60 minutes
**Blocks:** PR-014 (Archive Search MCP Tool)

### Description
Implement archive search functionality to query SkyFi's satellite imagery catalog with filtering by AOI, date range, product type, resolution, and cloud coverage. This is the starting point for most workflows - users search archives before ordering.

### Files to Create

#### Core Implementation (1 file)
```
src/skyfi/
â””â”€â”€ archives.ts          - Archive search methods
                          â€¢ searchArchives(params): Search archive catalog
                          â€¢ listArchives(params): List archives with pagination
                          â€¢ getArchiveById(id): Retrieve specific archive details
                          â€¢ Uses SkyFiClient from PR-005
                          â€¢ Uses types from src/types/skyfi-api.ts
                          â€¢ Validates AOI (WKT format, max 500k sqkm)
                          â€¢ Validates date ranges (ISO 8601)
                          â€¢ Validates filters (product type, resolution, cloud coverage)
```

#### Type Definitions (1 file)
```
src/types/
â””â”€â”€ archives.ts          - Archive-specific helper types
                          â€¢ ArchiveSearchParams (extends GetArchivesRequest)
                          â€¢ ArchiveSearchResult (processed response)
                          â€¢ ArchiveFilters (convenience type for filters)
                          â€¢ Note: Main types already in skyfi-api.ts
```

#### Validation Schemas (1 file)
```
src/schemas/
â””â”€â”€ archives.schemas.ts  - Archive validation schemas
                          â€¢ searchArchivesParamsSchema (extends base schema)
                          â€¢ archiveIdSchema
                          â€¢ aoiPolygonSchema (WKT validation)
                          â€¢ dateRangeSchema (ISO 8601 validation)
                          â€¢ Note: Main schemas already in skyfi.schemas.ts
```

#### Tests (2 files)
```
__tests__/skyfi/
â”œâ”€â”€ archives.test.ts              - Unit tests (50+ tests expected)
â”‚                                   â€¢ searchArchives() tests
â”‚                                   â€¢ listArchives() tests
â”‚                                   â€¢ getArchiveById() tests
â”‚                                   â€¢ AOI validation tests
â”‚                                   â€¢ Date range validation tests
â”‚                                   â€¢ Filter validation tests
â”‚                                   â€¢ Error handling tests
â”‚                                   â€¢ Mock SkyFiClient responses
â”‚
â””â”€â”€ archives.integration.test.ts  - Integration tests (20+ tests)
                                    â€¢ Full search workflow
                                    â€¢ Pagination tests
                                    â€¢ Complex filter combinations
                                    â€¢ Mock API responses
```

### Acceptance Criteria

#### Core Functionality
- [ ] `searchArchives()` method implemented
  - [ ] Accepts AOI (WKT polygon string)
  - [ ] Accepts optional date range (fromDate, toDate)
  - [ ] Accepts optional filters (product type, resolution, cloud coverage)
  - [ ] Returns parsed archive results
  - [ ] Handles pagination (pageNumber, pageSize)

- [ ] `listArchives()` method implemented (convenience wrapper for searchArchives)
  - [ ] Supports same parameters as searchArchives
  - [ ] Returns array of Archive objects

- [ ] `getArchiveById()` method implemented
  - [ ] Accepts archive ID
  - [ ] Returns single Archive object
  - [ ] Throws NotFoundError if archive doesn't exist

#### Validation
- [ ] AOI validation (WKT format, max 500 vertices, max 500k sqkm)
  - [ ] Validates WKT polygon syntax
  - [ ] Validates polygon is convex
  - [ ] Validates area â‰¤ 500,000 sqkm
  - [ ] Clear error messages for validation failures

- [ ] Date range validation
  - [ ] Validates ISO 8601 format
  - [ ] Validates fromDate < toDate
  - [ ] Clear error messages for invalid dates

- [ ] Product type filtering
  - [ ] Validates product types from ProductType enum
  - [ ] Supports multiple product types

- [ ] Resolution filtering
  - [ ] Validates resolutions from Resolution enum
  - [ ] Supports multiple resolutions

- [ ] Cloud coverage filtering
  - [ ] Validates maxCloudCoveragePercent (0-100)
  - [ ] Filters results by cloud coverage

- [ ] Open data filtering support
  - [ ] Accepts openData boolean flag
  - [ ] Filters results for open data sources

#### Error Handling
- [ ] Comprehensive error handling
  - [ ] ValidationError for invalid inputs
  - [ ] SkyFiAPIError for API errors
  - [ ] NotFoundError for missing archives
  - [ ] Clear, actionable error messages

- [ ] Response parsing and type validation
  - [ ] Validates API responses with Zod schemas
  - [ ] Parses nested objects (Archive, CloudCoverage, etc.)
  - [ ] Handles null/undefined fields properly

#### Testing
- [ ] Unit tests >80% coverage
  - [ ] All methods tested
  - [ ] All validation paths tested
  - [ ] All error scenarios tested

- [ ] Integration tests with mocked API responses
  - [ ] Test complete workflows
  - [ ] Test pagination
  - [ ] Test complex filters

- [ ] All tests passing
- [ ] Mock SkyFiClient properly (no real API calls in tests)

#### Code Quality
- [ ] TypeScript compiles with no errors
- [ ] ESLint passes with no errors
- [ ] 100% type coverage (no `any` types without justification)
- [ ] Follows coding standards from .claude/rules/coding-standards.md
- [ ] JSDoc comments for all public methods

### Implementation Notes

#### Key Dependencies
```typescript
import { SkyFiClient } from './client';
import {
  GetArchivesRequest,
  GetArchivesResponse,
  Archive
} from '../types/skyfi-api';
import {
  GetArchivesRequestSchema,
  GetArchivesResponseSchema,
  ArchiveSchema
} from '../schemas/skyfi.schemas';
import { logger } from '../lib/logger';
import { ValidationError, NotFoundError } from '../lib/errors';
```

#### Archive Search Usage Pattern
```typescript
import { ArchiveSearchClient } from './skyfi/archives';

const archiveClient = new ArchiveSearchClient(skyfiClient);

// Search archives
const results = await archiveClient.searchArchives({
  aoi: 'POLYGON((-97.75 30.25, -97.75 30.30, -97.70 30.30, -97.70 30.25, -97.75 30.25))',
  fromDate: '2024-01-01T00:00:00Z',
  toDate: '2024-12-31T23:59:59Z',
  productTypes: ['DAY', 'MULTISPECTRAL'],
  resolutions: ['HIGH', 'VERY_HIGH'],
  maxCloudCoveragePercent: 20,
  pageSize: 50,
});

// Get specific archive
const archive = await archiveClient.getArchiveById('archive-id-123');
```

#### Critical Implementation Details
1. **AOI Validation:** Use WKT parsing library or regex to validate polygon format
2. **Date Validation:** Use Zod's `.datetime()` validator for ISO 8601 dates
3. **Pagination:** Support pageNumber and pageSize parameters
4. **Response Parsing:** Validate with Zod schemas before returning
5. **Error Messages:** Provide clear, actionable messages (e.g., "AOI exceeds maximum area of 500,000 sqkm. Your AOI is 750,000 sqkm.")

#### API Endpoints Used
- `POST /archives` - Search archives with filters
- `GET /archives` - List archives (deprecated in favor of POST)
- `GET /archives/{archive_id}` - Get specific archive (if available)

### Testing Strategy

#### Unit Tests for archives.ts
```typescript
describe('ArchiveSearchClient', () => {
  describe('searchArchives', () => {
    it('should search archives with valid parameters');
    it('should apply date range filters');
    it('should apply product type filters');
    it('should apply resolution filters');
    it('should apply cloud coverage filters');
    it('should handle pagination');
    it('should validate AOI format');
    it('should validate AOI area limit');
    it('should throw ValidationError for invalid inputs');
  });

  describe('listArchives', () => {
    it('should list archives as array');
    it('should apply filters correctly');
  });

  describe('getArchiveById', () => {
    it('should retrieve archive by ID');
    it('should throw NotFoundError for missing archive');
  });

  describe('validation', () => {
    it('should validate WKT polygon syntax');
    it('should reject polygons >500k sqkm');
    it('should validate ISO 8601 dates');
    it('should validate date range (fromDate < toDate)');
    it('should validate product types');
    it('should validate resolutions');
    it('should validate cloud coverage percentage');
  });

  describe('error handling', () => {
    it('should handle API errors gracefully');
    it('should parse API error responses');
    it('should provide clear error messages');
  });
});
```

---

## ðŸ“‹ PR-008: Order Placement Implementation

### Overview
**Status:** READY TO START - UNBLOCKED âœ…
**Dependencies:** PR-005 âœ…, PR-006 âœ… (both complete)
**Priority:** High
**Estimated Time:** 60-75 minutes (includes delivery validator)
**Blocks:** PR-015 (Order Placement MCP Tools)

### Description
Implement order placement for both archive and tasking imagery, including delivery configuration validation for S3, GCS, and Azure. Order placement involves payment, so validation must be extremely robust to prevent costly mistakes.

### Files to Create

#### Core Implementation (1 file)
```
src/skyfi/
â””â”€â”€ orders.ts            - Order placement methods
                          â€¢ placeArchiveOrder(params): Order archive imagery
                          â€¢ placeTaskingOrder(params): Order new satellite captures
                          â€¢ Uses SkyFiClient from PR-005
                          â€¢ Uses types from src/types/skyfi-api.ts
                          â€¢ Integrates delivery validation
                          â€¢ Validates all order parameters
```

#### Type Definitions (1 file)
```
src/types/
â””â”€â”€ orders.ts            - Order-specific helper types
                          â€¢ ArchiveOrderParams (extends ArchiveOrderRequest)
                          â€¢ TaskingOrderParams (extends TaskingOrderRequest)
                          â€¢ DeliveryConfig (convenience type)
                          â€¢ OrderResult (processed response)
                          â€¢ Note: Main types already in skyfi-api.ts
```

#### Validation Schemas (1 file)
```
src/schemas/
â””â”€â”€ orders.schemas.ts    - Order validation schemas
                          â€¢ archiveOrderParamsSchema
                          â€¢ taskingOrderParamsSchema
                          â€¢ deliveryConfigSchema
                          â€¢ Note: Main schemas already in skyfi.schemas.ts
```

#### Support Library (1 file)
```
src/lib/
â””â”€â”€ delivery-validator.ts - Delivery configuration validation
                            â€¢ validateDeliveryConfig(driver, params)
                            â€¢ validateS3Config(params)
                            â€¢ validateGCSConfig(params)
                            â€¢ validateAzureConfig(params)
                            â€¢ Validates required fields per driver
                            â€¢ Clear error messages for missing/invalid fields
```

#### Tests (3 files)
```
__tests__/skyfi/
â”œâ”€â”€ orders.test.ts                - Unit tests (60+ tests expected)
â”‚                                   â€¢ placeArchiveOrder() tests
â”‚                                   â€¢ placeTaskingOrder() tests
â”‚                                   â€¢ Parameter validation tests
â”‚                                   â€¢ Delivery config validation tests
â”‚                                   â€¢ Error handling tests
â”‚
â”œâ”€â”€ orders.integration.test.ts    - Integration tests (20+ tests)
â”‚                                   â€¢ Complete order workflows
â”‚                                   â€¢ Different delivery drivers
â”‚                                   â€¢ Mock API responses
â”‚
__tests__/lib/
â””â”€â”€ delivery-validator.test.ts    - Delivery validator tests (40+ tests)
                                    â€¢ S3 config validation
                                    â€¢ GCS config validation
                                    â€¢ Azure config validation
                                    â€¢ Error scenarios
```

### Acceptance Criteria

#### Core Functionality
- [ ] `placeArchiveOrder()` method implemented
  - [ ] Accepts AOI (WKT polygon)
  - [ ] Accepts archiveId
  - [ ] Accepts optional delivery configuration
  - [ ] Accepts optional label and metadata
  - [ ] Accepts optional webhook URL
  - [ ] Returns order response with order ID and status

- [ ] `placeTaskingOrder()` method implemented
  - [ ] Accepts AOI (WKT polygon)
  - [ ] Accepts time window (windowStart, windowEnd)
  - [ ] Accepts product type and resolution
  - [ ] Accepts optional delivery configuration
  - [ ] Accepts optional tasking parameters (cloud coverage, off-nadir angle, etc.)
  - [ ] Accepts optional SAR parameters
  - [ ] Accepts optional providerWindowId (from pass prediction)
  - [ ] Returns order response with order ID and status

#### Delivery Driver Validation
- [ ] S3 delivery validation
  - [ ] Validates bucket name (required)
  - [ ] Validates region (required)
  - [ ] Validates prefix (optional)
  - [ ] Validates accessKeyId and secretAccessKey (required)
  - [ ] Clear error for missing required fields

- [ ] GCS (Google Cloud Storage) validation
  - [ ] Validates bucket name (required)
  - [ ] Validates prefix (optional)
  - [ ] Validates service account credentials (required)
  - [ ] Clear error for missing required fields

- [ ] Azure Blob Storage validation
  - [ ] Validates container name (required)
  - [ ] Validates connection string OR (accountName + accountKey) (required)
  - [ ] Validates prefix (optional)
  - [ ] Clear error for missing required fields

- [ ] NONE driver (no delivery)
  - [ ] Accepts NONE as valid driver
  - [ ] No validation required for deliveryParams

#### AOI and Parameter Validation
- [ ] AOI validation for orders
  - [ ] Validates WKT polygon format
  - [ ] Validates polygon is convex
  - [ ] No strict area limit for orders (unlike archive search)

- [ ] Webhook URL validation (optional)
  - [ ] Validates URL format
  - [ ] Validates https:// protocol (security)
  - [ ] Max length 2083 characters

- [ ] Time window validation (tasking orders)
  - [ ] Validates ISO 8601 format
  - [ ] Validates windowStart < windowEnd
  - [ ] Validates future dates

- [ ] Product type and resolution validation
  - [ ] Validates from allowed enums
  - [ ] Cross-validates (e.g., SAR requires SAR product type)

#### Error Handling
- [ ] Response parsing and type validation
  - [ ] Validates API responses with Zod schemas
  - [ ] Parses order response correctly
  - [ ] Handles payment errors gracefully

- [ ] Clear error messages for validation failures
  - [ ] "S3 bucket name is required for S3 delivery"
  - [ ] "Invalid webhook URL: must use https:// protocol"
  - [ ] "Time window must be in the future"

#### Testing
- [ ] Unit tests >80% coverage
- [ ] Integration tests with mocked API responses
- [ ] Delivery validator tests cover all drivers
- [ ] All tests passing
- [ ] Mock SkyFiClient properly

#### Code Quality
- [ ] TypeScript compiles with no errors
- [ ] ESLint passes with no errors
- [ ] 100% type coverage
- [ ] Follows coding standards
- [ ] JSDoc comments for all public methods

### Implementation Notes

#### Key Dependencies
```typescript
import { SkyFiClient } from './client';
import {
  ArchiveOrderRequest,
  TaskingOrderRequest,
  ArchiveOrderResponse,
  TaskingOrderResponse,
  DeliveryDriver
} from '../types/skyfi-api';
import { validateDeliveryConfig } from '../lib/delivery-validator';
import { logger } from '../lib/logger';
import { ValidationError } from '../lib/errors';
```

#### Order Placement Usage Pattern
```typescript
import { OrderClient } from './skyfi/orders';

const orderClient = new OrderClient(skyfiClient);

// Place archive order
const archiveOrder = await orderClient.placeArchiveOrder({
  aoi: 'POLYGON((-97.75 30.25, -97.75 30.30, -97.70 30.30, -97.70 30.25, -97.75 30.25))',
  archiveId: 'archive-123',
  deliveryDriver: 'S3',
  deliveryParams: {
    bucket: 'my-imagery-bucket',
    region: 'us-east-1',
    prefix: 'skyfi/archives/',
    accessKeyId: 'AKIAIOSFODNN7EXAMPLE',
    secretAccessKey: 'wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY',
  },
  webhookUrl: 'https://my-app.com/webhooks/skyfi',
  label: 'Downtown Austin imagery',
});

// Place tasking order
const taskingOrder = await orderClient.placeTaskingOrder({
  aoi: 'POLYGON((-97.75 30.25, -97.75 30.30, -97.70 30.30, -97.70 30.25, -97.75 30.25))',
  windowStart: '2025-12-01T00:00:00Z',
  windowEnd: '2025-12-15T23:59:59Z',
  productType: 'DAY',
  resolution: 'VERY_HIGH',
  maxCloudCoveragePercent: 10,
  deliveryDriver: 'GS',
  deliveryParams: {
    bucket: 'my-gcs-bucket',
    serviceAccountCredentials: { /* GCS credentials */ },
  },
});
```

#### Critical Implementation Details
1. **Security:** Never log delivery credentials (API keys, passwords)
2. **Validation:** Validate delivery config BEFORE placing order (prevent failed orders)
3. **Error Messages:** Provide actionable errors for missing/invalid delivery params
4. **Provider Window ID:** Support providerWindowId for Planet tasking orders
5. **SAR Parameters:** Validate SAR-specific params when productType is SAR

#### API Endpoints Used
- `POST /order-archive` - Place archive order
- `POST /order-tasking` - Place tasking order

### Testing Strategy

#### Unit Tests for orders.ts
```typescript
describe('OrderClient', () => {
  describe('placeArchiveOrder', () => {
    it('should place archive order with S3 delivery');
    it('should place archive order with GCS delivery');
    it('should place archive order with Azure delivery');
    it('should place archive order with no delivery (NONE)');
    it('should validate delivery config before ordering');
    it('should validate webhook URL format');
    it('should throw ValidationError for invalid params');
  });

  describe('placeTaskingOrder', () => {
    it('should place tasking order with valid params');
    it('should validate time window');
    it('should validate product type and resolution');
    it('should accept SAR parameters');
    it('should accept providerWindowId');
    it('should throw ValidationError for past time window');
  });
});

describe('DeliveryValidator', () => {
  describe('validateS3Config', () => {
    it('should validate complete S3 config');
    it('should throw error for missing bucket');
    it('should throw error for missing credentials');
  });

  describe('validateGCSConfig', () => {
    it('should validate complete GCS config');
    it('should throw error for missing bucket');
    it('should throw error for missing service account');
  });

  describe('validateAzureConfig', () => {
    it('should validate Azure with connection string');
    it('should validate Azure with account name + key');
    it('should throw error for missing container');
    it('should throw error for missing credentials');
  });
});
```

---

## ðŸ“‹ PR-009: Feasibility and Pass Prediction Implementation

### Overview
**Status:** READY TO START - UNBLOCKED âœ…
**Dependencies:** PR-005 âœ…, PR-006 âœ… (both complete)
**Priority:** High
**Estimated Time:** 50-65 minutes
**Blocks:** PR-016 (Feasibility Checking MCP Tools)

### Description
Implement feasibility checking and satellite pass prediction to help users determine if tasking orders can be fulfilled and when satellites will be overhead. Critical for tasking order planning.

### Files to Create

#### Core Implementation (1 file)
```
src/skyfi/
â””â”€â”€ feasibility.ts       - Feasibility check methods
                          â€¢ checkFeasibility(params): Check task feasibility
                          â€¢ predictPasses(params): Get satellite pass predictions
                          â€¢ getFeasibilityById(id): Retrieve feasibility results
                          â€¢ Uses SkyFiClient from PR-005
                          â€¢ Uses types from src/types/skyfi-api.ts
                          â€¢ Validates all parameters
```

#### Type Definitions (1 file)
```
src/types/
â””â”€â”€ feasibility.ts       - Feasibility-specific helper types
                          â€¢ FeasibilityParams (extends request type)
                          â€¢ PassPredictionParams (extends request type)
                          â€¢ FeasibilityResult (processed response)
                          â€¢ PassOpportunity (convenience type)
                          â€¢ Note: Main types already in skyfi-api.ts
```

#### Validation Schemas (1 file)
```
src/schemas/
â””â”€â”€ feasibility.schemas.ts - Feasibility validation schemas
                             â€¢ feasibilityParamsSchema
                             â€¢ passPredictionParamsSchema
                             â€¢ Note: Main schemas already in skyfi.schemas.ts
```

#### Tests (2 files)
```
__tests__/skyfi/
â”œâ”€â”€ feasibility.test.ts              - Unit tests (50+ tests expected)
â”‚                                      â€¢ checkFeasibility() tests
â”‚                                      â€¢ predictPasses() tests
â”‚                                      â€¢ getFeasibilityById() tests
â”‚                                      â€¢ Parameter validation tests
â”‚                                      â€¢ Error handling tests
â”‚
â””â”€â”€ feasibility.integration.test.ts  - Integration tests (15+ tests)
                                       â€¢ Complete feasibility workflows
                                       â€¢ Pass prediction workflows
                                       â€¢ Mock API responses
```

### Acceptance Criteria

#### Core Functionality
- [ ] `checkFeasibility()` method implemented
  - [ ] Accepts AOI (WKT polygon)
  - [ ] Accepts time window (startDate, endDate)
  - [ ] Accepts product type and resolution
  - [ ] Accepts optional max cloud coverage
  - [ ] Accepts optional provider filtering
  - [ ] Accepts optional SAR parameters
  - [ ] Returns feasibility ID and overall score
  - [ ] Returns provider-specific scores and opportunities

- [ ] `predictPasses()` method implemented
  - [ ] Accepts AOI (WKT polygon)
  - [ ] Accepts time range (fromDate, toDate)
  - [ ] Accepts optional product type filters
  - [ ] Accepts optional resolution filters
  - [ ] Accepts optional max off-nadir angle
  - [ ] Returns array of satellite passes
  - [ ] Includes timing, provider, elevation data
  - [ ] Includes providerWindowId for Planet

- [ ] `getFeasibilityById()` method implemented
  - [ ] Accepts feasibility ID
  - [ ] Returns feasibility results
  - [ ] Throws NotFoundError if not found

#### AOI and Time Window Validation
- [ ] AOI validation
  - [ ] Validates WKT polygon format
  - [ ] Validates polygon is convex

- [ ] Time window validation
  - [ ] Validates ISO 8601 format for dates
  - [ ] Validates startDate < endDate
  - [ ] Validates future dates (feasibility for future tasks)

#### Product Type and Resolution Filtering
- [ ] Product type validation
  - [ ] Validates from ProductType enum
  - [ ] Supports filtering in pass prediction

- [ ] Resolution validation
  - [ ] Validates from Resolution enum
  - [ ] Supports filtering in pass prediction

#### Provider Filtering
- [ ] Provider filtering (optional)
  - [ ] Validates from ApiProvider enum
  - [ ] Filters by specific provider (PLANET, UMBRA, etc.)

#### Pass Opportunity Parsing
- [ ] Pass opportunities parsed correctly
  - [ ] Extracts startTime and endTime
  - [ ] Extracts provider information
  - [ ] Extracts providerWindowId (important for Planet)
  - [ ] Extracts elevation data
  - [ ] Extracts weather details

#### Feasibility Score Interpretation
- [ ] Feasibility scores parsed
  - [ ] Overall score (0-100)
  - [ ] Provider-specific scores
  - [ ] Reasoning for scores
  - [ ] Opportunities per provider

#### Error Handling
- [ ] Response parsing and type validation
  - [ ] Validates with Zod schemas
  - [ ] Handles null/undefined fields
  - [ ] Clear error messages

#### Testing
- [ ] Unit tests >80% coverage
- [ ] Integration tests with mocked API responses
- [ ] All tests passing
- [ ] Mock SkyFiClient properly

#### Code Quality
- [ ] TypeScript compiles with no errors
- [ ] ESLint passes with no errors
- [ ] 100% type coverage
- [ ] Follows coding standards
- [ ] JSDoc comments for all public methods

### Implementation Notes

#### Key Dependencies
```typescript
import { SkyFiClient } from './client';
import {
  PlatformApiFeasibilityTaskRequest,
  PlatformApiPassPredictionRequest,
  PlatformFeasibilityTaskResponse,
  PlatformPassPredictionResponse,
  PlatformPass,
  Opportunity
} from '../types/skyfi-api';
import { logger } from '../lib/logger';
import { ValidationError, NotFoundError } from '../lib/errors';
```

#### Feasibility Check Usage Pattern
```typescript
import { FeasibilityClient } from './skyfi/feasibility';

const feasibilityClient = new FeasibilityClient(skyfiClient);

// Check feasibility
const feasibility = await feasibilityClient.checkFeasibility({
  aoi: 'POLYGON((-97.75 30.25, -97.75 30.30, -97.70 30.30, -97.70 30.25, -97.75 30.25))',
  productType: 'DAY',
  resolution: 'VERY_HIGH',
  startDate: '2025-12-01T00:00:00Z',
  endDate: '2025-12-15T23:59:59Z',
  maxCloudCoveragePercent: 10,
});

console.log(`Feasibility ID: ${feasibility.id}`);
console.log(`Overall Score: ${feasibility.overallScore?.score}/100`);

// Predict satellite passes
const passes = await feasibilityClient.predictPasses({
  aoi: 'POLYGON((-97.75 30.25, -97.75 30.30, -97.70 30.30, -97.70 30.25, -97.75 30.25))',
  fromDate: '2025-12-01T00:00:00Z',
  toDate: '2025-12-15T23:59:59Z',
  productTypes: ['DAY', 'MULTISPECTRAL'],
  resolutions: ['HIGH', 'VERY_HIGH'],
});

console.log(`Found ${passes.passes.length} satellite passes`);
passes.passes.forEach(pass => {
  console.log(`${pass.provider}: ${pass.startTime} - ${pass.endTime}`);
  if (pass.providerWindowId) {
    console.log(`  Provider Window ID: ${pass.providerWindowId}`);
  }
});
```

#### Critical Implementation Details
1. **Provider Window ID:** Extract and preserve providerWindowId from Planet passes (needed for ordering)
2. **Time Validation:** Ensure dates are in the future for feasibility checks
3. **Score Interpretation:** Scores are 0-100, higher is better
4. **Weather Data:** Parse weather details from pass predictions
5. **Opportunities:** Each provider may have multiple opportunities within the time window

#### API Endpoints Used
- `POST /feasibility` - Check task feasibility
- `POST /feasibility/pass-prediction` - Get satellite pass predictions
- `GET /feasibility/{feasibility_id}` - Get feasibility details (if available)

### Testing Strategy

#### Unit Tests for feasibility.ts
```typescript
describe('FeasibilityClient', () => {
  describe('checkFeasibility', () => {
    it('should check feasibility with valid params');
    it('should validate AOI format');
    it('should validate time window');
    it('should validate product type and resolution');
    it('should accept optional provider filter');
    it('should accept SAR parameters');
    it('should parse feasibility score');
    it('should parse provider opportunities');
    it('should throw ValidationError for invalid params');
  });

  describe('predictPasses', () => {
    it('should predict satellite passes');
    it('should apply product type filters');
    it('should apply resolution filters');
    it('should parse pass timing correctly');
    it('should extract providerWindowId for Planet');
    it('should parse elevation data');
    it('should parse weather details');
  });

  describe('getFeasibilityById', () => {
    it('should retrieve feasibility by ID');
    it('should throw NotFoundError for missing feasibility');
  });

  describe('validation', () => {
    it('should validate future dates');
    it('should validate date range');
    it('should validate product types');
    it('should validate providers');
  });
});
```

---

## ðŸ“‹ PR-010: Order Management Implementation

### Overview
**Status:** READY TO START - UNBLOCKED âœ…
**Dependencies:** PR-005 âœ…, PR-006 âœ… (both complete)
**Priority:** High
**Estimated Time:** 45-60 minutes
**Blocks:** PR-017 (Order Management MCP Tools)

### Description
Implement order management functionality to list orders, retrieve order details, check status, and trigger redelivery. Essential for tracking long-running tasking orders.

### Files to Create

#### Core Implementation (1 file)
```
src/skyfi/
â””â”€â”€ order-management.ts  - Order management methods
                          â€¢ listOrders(params): List all orders with filters
                          â€¢ getOrderById(id): Get order details
                          â€¢ triggerRedelivery(id, params): Trigger order redelivery
                          â€¢ Uses SkyFiClient from PR-005
                          â€¢ Uses types from src/types/skyfi-api.ts
                          â€¢ Parses order status and delivery info
```

#### Type Definitions (1 file)
```
src/types/
â””â”€â”€ order-status.ts      - Order status helper types
                          â€¢ OrderStatusInfo (status interpretation)
                          â€¢ DeliveryStatusInfo (delivery status)
                          â€¢ OrderFilters (convenience type for filters)
                          â€¢ Note: Main types already in skyfi-api.ts
```

#### Validation Schemas (1 file)
```
src/schemas/
â””â”€â”€ order-management.schemas.ts - Validation schemas
                                  â€¢ listOrdersParamsSchema
                                  â€¢ redeliveryParamsSchema
                                  â€¢ orderIdSchema
                                  â€¢ Note: Main schemas in skyfi.schemas.ts
```

#### Tests (2 files)
```
__tests__/skyfi/
â”œâ”€â”€ order-management.test.ts              - Unit tests (50+ tests)
â”‚                                           â€¢ listOrders() tests
â”‚                                           â€¢ getOrderById() tests
â”‚                                           â€¢ triggerRedelivery() tests
â”‚                                           â€¢ Filter validation tests
â”‚                                           â€¢ Status parsing tests
â”‚
â””â”€â”€ order-management.integration.test.ts  - Integration tests (15+ tests)
                                            â€¢ Complete order tracking workflows
                                            â€¢ Pagination tests
                                            â€¢ Mock API responses
```

### Acceptance Criteria

#### Core Functionality
- [ ] `listOrders()` method implemented
  - [ ] Supports pagination (pageNumber, pageSize)
  - [ ] Supports order type filtering (ARCHIVE, TASKING)
  - [ ] Supports status filtering
  - [ ] Supports date range filtering
  - [ ] Returns array of orders with event info
  - [ ] Parses order details correctly

- [ ] `getOrderById()` method implemented
  - [ ] Accepts order ID
  - [ ] Returns complete order details
  - [ ] Includes archive details (for archive orders)
  - [ ] Includes tasking details (for tasking orders)
  - [ ] Includes delivery status
  - [ ] Throws NotFoundError if order doesn't exist

- [ ] `triggerRedelivery()` method implemented
  - [ ] Accepts order ID
  - [ ] Accepts optional new delivery config
  - [ ] Validates delivery config if provided
  - [ ] Returns success confirmation
  - [ ] Handles already-delivered orders

#### Order Status Enum and Interpretation
- [ ] DeliveryStatus enum used correctly
  - [ ] CREATED - Order created
  - [ ] STARTED - Processing started
  - [ ] PAYMENT_FAILED - Payment failed
  - [ ] PLATFORM_FAILED - Platform error
  - [ ] PROVIDER_PENDING - Waiting for provider
  - [ ] PROVIDER_COMPLETE - Provider delivered
  - [ ] PROVIDER_FAILED - Provider failed
  - [ ] PROCESSING_PENDING - Processing pending
  - [ ] PROCESSING_COMPLETE - Processing done
  - [ ] PROCESSING_FAILED - Processing failed
  - [ ] DELIVERY_PENDING - Delivery in progress
  - [ ] DELIVERY_COMPLETED - Delivery done âœ…
  - [ ] DELIVERY_FAILED - Delivery failed

- [ ] Status interpretation helpers
  - [ ] isOrderComplete(status): boolean
  - [ ] isOrderFailed(status): boolean
  - [ ] isOrderInProgress(status): boolean

#### Order Type Filtering
- [ ] Filter by ARCHIVE orders
- [ ] Filter by TASKING orders
- [ ] Filter by both (no filter)

#### Status Filtering
- [ ] Filter by specific status
- [ ] Filter by multiple statuses

#### Date Range Filtering
- [ ] Filter by creation date range
- [ ] Validate date range (startDate < endDate)

#### Delivery Status Tracking
- [ ] Parse delivery status from order
- [ ] Parse delivery URLs (tilesUrl, downloadImageUrl, downloadPayloadUrl)
- [ ] Parse deliverable ID
- [ ] Parse delivery events

#### Error Handling
- [ ] Response parsing and type validation
- [ ] Clear error messages
- [ ] Handle missing orders gracefully

#### Testing
- [ ] Unit tests >80% coverage
- [ ] Integration tests with mocked API responses
- [ ] All tests passing
- [ ] Mock SkyFiClient properly

#### Code Quality
- [ ] TypeScript compiles with no errors
- [ ] ESLint passes with no errors
- [ ] 100% type coverage
- [ ] Follows coding standards
- [ ] JSDoc comments for all public methods

### Implementation Notes

#### Key Dependencies
```typescript
import { SkyFiClient } from './client';
import {
  ListOrdersRequest,
  ListOrdersResponse,
  OrderResponse,
  OrderRedeliveryRequest,
  OrderType,
  DeliveryStatus
} from '../types/skyfi-api';
import { logger } from '../lib/logger';
import { ValidationError, NotFoundError } from '../lib/errors';
```

#### Order Management Usage Pattern
```typescript
import { OrderManagementClient } from './skyfi/order-management';

const orderMgmt = new OrderManagementClient(skyfiClient);

// List all orders
const allOrders = await orderMgmt.listOrders({
  pageSize: 50,
});

// List only tasking orders
const taskingOrders = await orderMgmt.listOrders({
  orderType: 'TASKING',
  pageSize: 50,
});

// Get specific order
const order = await orderMgmt.getOrderById('order-123');
console.log(`Order status: ${order.status}`);
console.log(`Delivery URL: ${order.downloadImageUrl}`);

// Trigger redelivery with new S3 bucket
await orderMgmt.triggerRedelivery('order-123', {
  deliveryDriver: 'S3',
  deliveryParams: {
    bucket: 'new-bucket',
    region: 'us-west-2',
    accessKeyId: '...',
    secretAccessKey: '...',
  },
});
```

#### Critical Implementation Details
1. **Status Interpretation:** Provide helper methods to check if order is complete/failed/in-progress
2. **Order Types:** Handle both archive and tasking order responses (different fields)
3. **Delivery URLs:** Parse and expose download URLs when available
4. **Pagination:** Support pagination for large order lists
5. **Redelivery Validation:** Validate delivery config before triggering redelivery

#### API Endpoints Used
- `GET /orders` - List all orders with filtering
- `GET /orders/{order_id}` - Get order details
- `POST /orders/{order_id}/redelivery` - Trigger redelivery

### Testing Strategy

#### Unit Tests for order-management.ts
```typescript
describe('OrderManagementClient', () => {
  describe('listOrders', () => {
    it('should list all orders');
    it('should filter by order type (ARCHIVE)');
    it('should filter by order type (TASKING)');
    it('should support pagination');
    it('should parse order info correctly');
    it('should parse delivery events');
  });

  describe('getOrderById', () => {
    it('should retrieve archive order by ID');
    it('should retrieve tasking order by ID');
    it('should parse delivery status');
    it('should parse download URLs');
    it('should throw NotFoundError for missing order');
  });

  describe('triggerRedelivery', () => {
    it('should trigger redelivery with new config');
    it('should trigger redelivery without config change');
    it('should validate delivery config');
    it('should handle errors gracefully');
  });

  describe('status helpers', () => {
    it('should identify completed orders');
    it('should identify failed orders');
    it('should identify in-progress orders');
  });
});
```

---

## ðŸ“‹ PR-011: Notifications/Monitoring Implementation

### Overview
**Status:** READY TO START - UNBLOCKED âœ…
**Dependencies:** PR-005 âœ…, PR-006 âœ… (both complete)
**Priority:** High
**Estimated Time:** 45-60 minutes
**Blocks:** PR-018 (Monitoring MCP Tools)

### Description
Implement monitoring notifications to set up webhooks for new imagery alerts based on AOI and filter criteria. Enables automated workflows.

### Files to Create

#### Core Implementation (1 file)
```
src/skyfi/
â””â”€â”€ notifications.ts     - Notification methods
                          â€¢ createNotification(params): Create monitoring notification
                          â€¢ listNotifications(params): List all notifications
                          â€¢ getNotificationById(id): Get notification details
                          â€¢ deleteNotification(id): Delete notification
                          â€¢ Uses SkyFiClient from PR-005
                          â€¢ Uses types from src/types/skyfi-api.ts
                          â€¢ Validates webhook URLs and filters
```

#### Type Definitions (1 file)
```
src/types/
â””â”€â”€ notifications.ts     - Notification-specific helper types
                          â€¢ NotificationParams (extends request type)
                          â€¢ NotificationResult (processed response)
                          â€¢ NotificationFilters (convenience type)
                          â€¢ Note: Main types already in skyfi-api.ts
```

#### Validation Schemas (1 file)
```
src/schemas/
â””â”€â”€ notifications.schemas.ts - Notification validation schemas
                               â€¢ createNotificationParamsSchema
                               â€¢ listNotificationsParamsSchema
                               â€¢ webhookUrlSchema
                               â€¢ Note: Main schemas in skyfi.schemas.ts
```

#### Tests (2 files)
```
__tests__/skyfi/
â”œâ”€â”€ notifications.test.ts              - Unit tests (50+ tests expected)
â”‚                                        â€¢ createNotification() tests
â”‚                                        â€¢ listNotifications() tests
â”‚                                        â€¢ getNotificationById() tests
â”‚                                        â€¢ deleteNotification() tests
â”‚                                        â€¢ Webhook URL validation tests
â”‚                                        â€¢ Filter validation tests
â”‚
â””â”€â”€ notifications.integration.test.ts  - Integration tests (15+ tests)
                                         â€¢ Complete notification workflows
                                         â€¢ Mock API responses
```

### Acceptance Criteria

#### Core Functionality
- [ ] `createNotification()` method implemented
  - [ ] Accepts AOI (WKT polygon, max 500k sqkm)
  - [ ] Accepts webhook URL (required)
  - [ ] Accepts optional GSD (ground sample distance) range
  - [ ] Accepts optional product type filter
  - [ ] Returns notification ID and details
  - [ ] Validates all parameters

- [ ] `listNotifications()` method implemented
  - [ ] Supports pagination (pageNumber, pageSize)
  - [ ] Returns array of notifications with history
  - [ ] Includes lastTriggered and triggerCount

- [ ] `getNotificationById()` method implemented
  - [ ] Accepts notification ID
  - [ ] Returns notification details with history
  - [ ] Throws NotFoundError if not found

- [ ] `deleteNotification()` method implemented
  - [ ] Accepts notification ID
  - [ ] Deletes notification
  - [ ] Returns success confirmation
  - [ ] Handles already-deleted notifications gracefully

#### AOI Validation for Notifications
- [ ] AOI validation (max 500k sqkm)
  - [ ] Validates WKT polygon format
  - [ ] Validates polygon is convex
  - [ ] Validates area â‰¤ 500,000 sqkm
  - [ ] Clear error message for oversized AOI

#### Webhook URL Validation
- [ ] Webhook URL validation
  - [ ] Validates URL format
  - [ ] Validates https:// protocol (security requirement)
  - [ ] Max length 2083 characters
  - [ ] Rejects http:// URLs (insecure)

#### Filter Criteria Validation
- [ ] GSD (ground sample distance) range
  - [ ] Validates gsdMin and gsdMax are positive numbers
  - [ ] Validates gsdMin < gsdMax
  - [ ] Both optional

- [ ] Product type filter
  - [ ] Validates from ProductType enum
  - [ ] Optional

#### Response Parsing
- [ ] Notification response parsed correctly
  - [ ] ID, ownerId, AOI
  - [ ] Webhook URL
  - [ ] Filter criteria (gsdMin, gsdMax, productType)
  - [ ] Created timestamp
  - [ ] Last triggered timestamp
  - [ ] Trigger count

#### Error Handling
- [ ] Response parsing and type validation
- [ ] Clear error messages for validation failures
- [ ] Handle API errors gracefully

#### Testing
- [ ] Unit tests >80% coverage
- [ ] Integration tests with mocked API responses
- [ ] All tests passing
- [ ] Mock SkyFiClient properly

#### Code Quality
- [ ] TypeScript compiles with no errors
- [ ] ESLint passes with no errors
- [ ] 100% type coverage
- [ ] Follows coding standards
- [ ] JSDoc comments for all public methods

### Implementation Notes

#### Key Dependencies
```typescript
import { SkyFiClient } from './client';
import {
  CreateNotificationRequest,
  ListNotificationsRequest,
  NotificationResponse,
  NotificationWithHistoryResponse,
  ListNotificationsResponse,
  ProductType
} from '../types/skyfi-api';
import { logger } from '../lib/logger';
import { ValidationError, NotFoundError } from '../lib/errors';
```

#### Notifications Usage Pattern
```typescript
import { NotificationsClient } from './skyfi/notifications';

const notificationsClient = new NotificationsClient(skyfiClient);

// Create notification
const notification = await notificationsClient.createNotification({
  aoi: 'POLYGON((-97.75 30.25, -97.75 30.30, -97.70 30.30, -97.70 30.25, -97.75 30.25))',
  webhookUrl: 'https://my-app.com/webhooks/skyfi/new-imagery',
  gsdMin: 0.3,
  gsdMax: 1.0,
  productType: 'DAY',
});

console.log(`Notification created: ${notification.id}`);

// List all notifications
const notifications = await notificationsClient.listNotifications({
  pageSize: 50,
});

console.log(`You have ${notifications.total} active notifications`);
notifications.notifications.forEach(n => {
  console.log(`${n.id}: Triggered ${n.triggerCount} times`);
  if (n.lastTriggered) {
    console.log(`  Last triggered: ${n.lastTriggered}`);
  }
});

// Delete notification
await notificationsClient.deleteNotification(notification.id);
```

#### Critical Implementation Details
1. **Webhook Security:** Only accept https:// URLs (reject http://)
2. **AOI Limit:** Enforce 500k sqkm limit for monitoring (same as archive search)
3. **GSD Range:** Ground sample distance in meters (smaller = higher resolution)
4. **Trigger History:** Parse and expose lastTriggered and triggerCount
5. **Product Type Filter:** Optional, but validates against enum if provided

#### API Endpoints Used
- `POST /notifications` - Create monitoring notification
- `GET /notifications` - List notifications
- `GET /notifications/{notification_id}` - Get notification details
- `DELETE /notifications/{notification_id}` - Delete notification

### Testing Strategy

#### Unit Tests for notifications.ts
```typescript
describe('NotificationsClient', () => {
  describe('createNotification', () => {
    it('should create notification with valid params');
    it('should validate AOI format');
    it('should validate AOI area limit (500k sqkm)');
    it('should validate webhook URL format');
    it('should require https:// for webhook URL');
    it('should reject http:// webhook URLs');
    it('should validate GSD range');
    it('should validate product type');
    it('should throw ValidationError for invalid params');
  });

  describe('listNotifications', () => {
    it('should list all notifications');
    it('should support pagination');
    it('should parse trigger history');
  });

  describe('getNotificationById', () => {
    it('should retrieve notification by ID');
    it('should include trigger history');
    it('should throw NotFoundError for missing notification');
  });

  describe('deleteNotification', () => {
    it('should delete notification');
    it('should handle already-deleted notification');
  });

  describe('validation', () => {
    it('should validate webhook URL protocol');
    it('should validate GSD min < max');
    it('should validate product type from enum');
  });
});
```

---

## ðŸ“‹ PR-012: Pricing API Implementation

### Overview
**Status:** READY TO START - UNBLOCKED âœ…
**Dependencies:** PR-005 âœ…, PR-006 âœ… (both complete)
**Priority:** Medium
**Estimated Time:** 45-60 minutes
**Blocks:** PR-019 (Pricing MCP Tool)

### Description
Implement pricing API to retrieve cost estimates for different product types, resolutions, and AOI sizes. Critical for cost transparency before ordering.

### Files to Create

#### Core Implementation (1 file)
```
src/skyfi/
â””â”€â”€ pricing.ts           - Pricing methods
                          â€¢ getPricing(params): Get pricing information
                          â€¢ Uses SkyFiClient from PR-005
                          â€¢ Uses types from src/types/skyfi-api.ts
                          â€¢ Parses pricing data
```

#### Type Definitions (1 file)
```
src/types/
â””â”€â”€ pricing.ts           - Pricing-specific helper types
                          â€¢ PricingParams (extends request type)
                          â€¢ PricingResult (processed response)
                          â€¢ PriceTier (convenience type)
                          â€¢ Note: Main types already in skyfi-api.ts
                          â€¢ Note: Pricing response type may need definition
```

#### Validation Schemas (1 file)
```
src/schemas/
â””â”€â”€ pricing.schemas.ts   - Pricing validation schemas
                          â€¢ pricingParamsSchema
                          â€¢ Note: Main schemas in skyfi.schemas.ts
```

#### Support Library (1 file)
```
src/lib/
â””â”€â”€ pricing-calculator.ts - Helper for cost calculations
                            â€¢ calculateOrderCost(aoi, productType, resolution)
                            â€¢ estimateTotalCost(orders)
                            â€¢ formatPrice(cents): Format price for display
                            â€¢ Helper methods for pricing calculations
```

#### Tests (2 files)
```
__tests__/skyfi/
â”œâ”€â”€ pricing.test.ts          - Unit tests (40+ tests expected)
â”‚                              â€¢ getPricing() tests
â”‚                              â€¢ Parameter validation tests
â”‚                              â€¢ Response parsing tests
â”‚
__tests__/lib/
â””â”€â”€ pricing-calculator.test.ts - Calculator tests (30+ tests)
                                 â€¢ Cost calculation tests
                                 â€¢ Price formatting tests
                                 â€¢ Estimation tests
```

### Acceptance Criteria

#### Core Functionality
- [ ] `getPricing()` method implemented
  - [ ] Accepts optional AOI (for size-based pricing)
  - [ ] Returns pricing information
  - [ ] Parses pricing tiers
  - [ ] Validates AOI if provided

#### Product Type and Resolution Support
- [ ] Support for all product types
  - [ ] DAY, NIGHT, VIDEO, MULTISPECTRAL, HYPERSPECTRAL, SAR, STEREO
  - [ ] Pricing varies by product type

- [ ] Support for all resolutions
  - [ ] LOW, MEDIUM, HIGH, VERY_HIGH, SUPER_HIGH, ULTRA_HIGH, CM_30, CM_50
  - [ ] Pricing varies by resolution

#### AOI Size-Based Pricing
- [ ] AOI size calculation
  - [ ] If AOI provided, calculate area in sqkm
  - [ ] Pricing may scale with AOI size
  - [ ] Validate AOI format if provided

#### Response Parsing and Type Validation
- [ ] Pricing response parsed correctly
  - [ ] Price tiers
  - [ ] Currency
  - [ ] Pricing rules
  - [ ] Note: Exact response format TBD (may need to explore API)

#### Pricing Calculator Helper
- [ ] `calculateOrderCost()` helper
  - [ ] Calculates cost for single order
  - [ ] Accepts AOI area, product type, resolution
  - [ ] Returns estimated cost

- [ ] `estimateTotalCost()` helper
  - [ ] Calculates total cost for multiple orders
  - [ ] Accepts array of order params
  - [ ] Returns total estimated cost

- [ ] `formatPrice()` helper
  - [ ] Formats price for display (e.g., "$1,234.56")
  - [ ] Handles different currencies
  - [ ] Handles cents/dollars conversion

#### Clear Presentation of Pricing Tiers
- [ ] Pricing tiers clearly structured
- [ ] Easy to understand for AI agents
- [ ] Reference to official pricing PDF included

#### Error Handling
- [ ] Response parsing and type validation
- [ ] Clear error messages
- [ ] Handle API errors gracefully

#### Testing
- [ ] Unit tests >80% coverage
- [ ] Integration tests with mocked API responses (if applicable)
- [ ] Pricing calculator tests comprehensive
- [ ] All tests passing
- [ ] Mock SkyFiClient properly

#### Code Quality
- [ ] TypeScript compiles with no errors
- [ ] ESLint passes with no errors
- [ ] 100% type coverage
- [ ] Follows coding standards
- [ ] JSDoc comments for all public methods

### Implementation Notes

#### Key Dependencies
```typescript
import { SkyFiClient } from './client';
import {
  PricingRequest,
  ProductType,
  Resolution
} from '../types/skyfi-api';
import { calculateOrderCost, formatPrice } from '../lib/pricing-calculator';
import { logger } from '../lib/logger';
import { ValidationError } from '../lib/errors';
```

#### Pricing Usage Pattern
```typescript
import { PricingClient } from './skyfi/pricing';
import { calculateOrderCost, formatPrice } from './lib/pricing-calculator';

const pricingClient = new PricingClient(skyfiClient);

// Get pricing information
const pricing = await pricingClient.getPricing({
  aoi: 'POLYGON((-97.75 30.25, -97.75 30.30, -97.70 30.30, -97.70 30.25, -97.75 30.25))',
});

console.log('Pricing information:', pricing);

// Calculate order cost
const cost = calculateOrderCost(
  25.5,           // AOI area in sqkm
  'DAY',          // product type
  'VERY_HIGH'     // resolution
);

console.log(`Estimated cost: ${formatPrice(cost)}`);
```

#### Critical Implementation Details
1. **Pricing Response:** May need to explore API to determine exact response format
2. **AOI Area:** Calculate area from WKT polygon if AOI provided
3. **Pricing Tiers:** Different pricing for different product types and resolutions
4. **Currency:** Support USD (primary), possibly other currencies
5. **Reference:** Link to official pricing PDF: https://skyfi.com/files/SkyFi_Pricing_2025.pdf

#### API Endpoints Used
- `POST /pricing` - Get pricing information

#### Note on Pricing Response Type
The exact structure of the pricing response may not be fully documented in the OpenAPI spec. You may need to:
1. Make a test API call to see the actual response format
2. Define the PricingResponse type in src/types/pricing.ts
3. Create corresponding Zod schema in src/schemas/pricing.schemas.ts

If the API returns dynamic pricing data, be flexible in the type definition.

### Testing Strategy

#### Unit Tests for pricing.ts
```typescript
describe('PricingClient', () => {
  describe('getPricing', () => {
    it('should get pricing without AOI');
    it('should get pricing with AOI');
    it('should validate AOI format if provided');
    it('should parse pricing response');
    it('should handle API errors gracefully');
  });

  describe('response parsing', () => {
    it('should parse pricing tiers');
    it('should parse currency');
    it('should handle null/undefined fields');
  });
});

describe('PricingCalculator', () => {
  describe('calculateOrderCost', () => {
    it('should calculate cost for DAY imagery');
    it('should calculate cost for SAR imagery');
    it('should scale with AOI size');
    it('should vary by resolution');
  });

  describe('estimateTotalCost', () => {
    it('should sum costs for multiple orders');
    it('should handle empty array');
  });

  describe('formatPrice', () => {
    it('should format USD prices');
    it('should handle cents to dollars conversion');
    it('should add currency symbol');
    it('should format with commas for thousands');
  });
});
```

---

## ðŸš€ Recommended Execution Strategy

### Option 1: Sequential (Conservative)
```
1. Agent A â†’ PR-007 (45-60 min)
2. Agent A â†’ PR-008 (60-75 min)
3. Agent A â†’ PR-009 (50-65 min)
4. Agent A â†’ PR-010 (45-60 min)
5. Agent A â†’ PR-011 (45-60 min)
6. Agent A â†’ PR-012 (45-60 min)
Total time: 290-380 minutes sequential (4.8-6.3 hours)
```

### Option 2: 2 Agents in Parallel
```
Agent A:                          Agent B:
1. PR-007 (45-60 min)            1. PR-008 (60-75 min)
2. PR-009 (50-65 min)            2. PR-010 (45-60 min)
3. PR-011 (45-60 min)            3. PR-012 (45-60 min)
Total: 140-185 min               Total: 150-195 min

Overall time: 150-195 minutes (2.5-3.25 hours)
```

### Option 3: 3 Agents in Parallel
```
Agent A:                Agent B:                Agent C:
1. PR-007 (45-60 min)  1. PR-008 (60-75 min)  1. PR-009 (50-65 min)
2. PR-010 (45-60 min)  2. PR-011 (45-60 min)  2. PR-012 (45-60 min)
Total: 90-120 min      Total: 105-135 min     Total: 95-125 min

Overall time: 105-135 minutes (1.75-2.25 hours)
```

### Option 4: Maximum Parallelization (6 Agents) â­
```
Agent A: PR-007 (45-60 min)
Agent B: PR-008 (60-75 min)  â† Longest
Agent C: PR-009 (50-65 min)
Agent D: PR-010 (45-60 min)
Agent E: PR-011 (45-60 min)
Agent F: PR-012 (45-60 min)

Overall time: 60-75 minutes (1.0-1.25 hours)
```

**Recommendation: Use maximum available parallelization** âœ…
- Zero file conflicts confirmed
- Independent functionality
- All well-defined with clear acceptance criteria
- Maximize development velocity

---

## ðŸ“Š Impact Analysis

### After All PRs (007-012) Complete
**Unblocks:** 6 PRs in Block 5 (MCP Tools) - but they also need PR-013 (MCP Server)

Block 5 PRs that become unblocked:
- PR-014: Archive Search MCP Tool (needs PR-007 + PR-013)
- PR-015: Order Placement MCP Tools (needs PR-008 + PR-013)
- PR-016: Feasibility Checking MCP Tools (needs PR-009 + PR-013)
- PR-017: Order Management MCP Tools (needs PR-010 + PR-013)
- PR-018: Monitoring MCP Tools (needs PR-011 + PR-013)
- PR-019: Pricing MCP Tool (needs PR-012 + PR-013)

### Critical Path
```
PR-005 âœ… â†’ Block 3 (PRs 007-012, can run in parallel)
                â†“
            Block 5 (PRs 014-019, need PR-013 also)
                â†“
            Block 6 (Demo Agent)
```

**Note:** Block 5 (MCP Tools) requires BOTH Block 3 (API Client Implementation) AND Block 4 (MCP Server Setup) to be complete. PR-013 from Block 4 is currently available for planning/implementation.

---

## ðŸ“‹ Common Implementation Patterns

All 6 PRs follow these common patterns:

### 1. Client Wrapper Class
```typescript
import { SkyFiClient } from './client';

export class ArchiveSearchClient {
  constructor(private readonly client: SkyFiClient) {}

  async searchArchives(params: GetArchivesRequest): Promise<GetArchivesResponse> {
    // Validate params
    const validated = GetArchivesRequestSchema.parse(params);

    // Make API call
    const response = await this.client.post<GetArchivesResponse>(
      '/archives',
      validated
    );

    // Validate response
    return GetArchivesResponseSchema.parse(response);
  }
}
```

### 2. Type Definitions
- Import types from `src/types/skyfi-api.ts` (PR-006)
- Create convenience types in `src/types/<module>.ts`
- Extend base types as needed

### 3. Validation Schemas
- Import base schemas from `src/schemas/skyfi.schemas.ts` (PR-006)
- Create module-specific schemas in `src/schemas/<module>.schemas.ts`
- Extend base schemas as needed
- Use Zod's `.parse()` for runtime validation

### 4. Error Handling
```typescript
import { logger } from '../lib/logger';
import { ValidationError, SkyFiAPIError } from '../lib/errors';

try {
  // Validate input
  const validated = schema.parse(params);

  // Make API call
  const response = await this.client.post(url, validated);

  // Validate response
  return responseSchema.parse(response);
} catch (error) {
  if (error instanceof z.ZodError) {
    throw new ValidationError('Invalid parameters', error.errors);
  }

  logger.error('API call failed', { error, params });
  throw error;
}
```

### 5. Testing Pattern
```typescript
import { SkyFiClient } from '../../src/skyfi/client';
import { ArchiveSearchClient } from '../../src/skyfi/archives';

jest.mock('../../src/skyfi/client');

describe('ArchiveSearchClient', () => {
  let client: jest.Mocked<SkyFiClient>;
  let archiveClient: ArchiveSearchClient;

  beforeEach(() => {
    client = new SkyFiClient({}) as jest.Mocked<SkyFiClient>;
    archiveClient = new ArchiveSearchClient(client);
  });

  it('should search archives', async () => {
    // Arrange
    const mockResponse = { /* mock data */ };
    client.post.mockResolvedValue(mockResponse);

    // Act
    const result = await archiveClient.searchArchives({ /* params */ });

    // Assert
    expect(client.post).toHaveBeenCalledWith('/archives', expect.any(Object));
    expect(result).toEqual(mockResponse);
  });
});
```

---

## âœ… Pre-Flight Checklist

### Before Starting Any PR in Block 3
- [x] PR-001 is Complete (Project Setup)
- [x] PR-004 is Complete (Logging and Error Handling)
- [x] PR-005 is Complete (SkyFi API Client) âš ï¸ **VERIFY**
- [x] PR-006 is Complete (Type Definitions) âœ…
- [x] All tests passing
- [x] TypeScript builds successfully
- [x] No other agent working on conflicting files

### Verification Commands
```bash
# Build check
npm run build

# Test check
npm test

# Lint check
npm run lint

# Type check
npm run typecheck
```

---

## ðŸ“ Git Workflow

**Branch:** `claude/review-task-list-state-01DZuwKLGGSbucKZKqzUHCEm`

### Commit Message Templates

#### PR-007
```bash
feat(archives): implement archive search functionality

- Add searchArchives() method with AOI and filter support
- Add listArchives() convenience method
- Add getArchiveById() method
- Implement AOI validation (WKT format, max 500k sqkm)
- Implement date range and filter validation
- Comprehensive error handling with clear messages
- 70+ tests with >80% coverage

Implements: PR-007
```

#### PR-008
```bash
feat(orders): implement order placement for archive and tasking imagery

- Add placeArchiveOrder() method
- Add placeTaskingOrder() method
- Implement delivery configuration validator for S3, GCS, Azure
- Add delivery driver validation
- Add webhook URL validation
- Comprehensive parameter validation
- 100+ tests with >80% coverage

Implements: PR-008
```

#### PR-009
```bash
feat(feasibility): implement feasibility checking and pass prediction

- Add checkFeasibility() method
- Add predictPasses() method
- Add getFeasibilityById() method
- Parse feasibility scores and provider opportunities
- Extract providerWindowId for Planet passes
- Parse weather details and elevation data
- 65+ tests with >80% coverage

Implements: PR-009
```

#### PR-010
```bash
feat(order-management): implement order tracking and management

- Add listOrders() method with filtering and pagination
- Add getOrderById() method
- Add triggerRedelivery() method
- Implement order status interpretation helpers
- Parse delivery status and URLs
- Comprehensive error handling
- 65+ tests with >80% coverage

Implements: PR-010
```

#### PR-011
```bash
feat(notifications): implement monitoring notifications

- Add createNotification() method
- Add listNotifications() method
- Add getNotificationById() method
- Add deleteNotification() method
- Implement webhook URL validation (require https)
- Implement AOI validation (max 500k sqkm)
- Parse trigger history
- 65+ tests with >80% coverage

Implements: PR-011
```

#### PR-012
```bash
feat(pricing): implement pricing API and cost calculator

- Add getPricing() method
- Implement pricing calculator helper
- Add calculateOrderCost() utility
- Add estimateTotalCost() utility
- Add formatPrice() utility
- Parse pricing tiers
- 70+ tests with >80% coverage

Implements: PR-012
```

---

## ðŸŽ¯ Success Metrics

### Code Quality Metrics
- [ ] All 6 PRs: TypeScript compiles with no errors
- [ ] All 6 PRs: ESLint passes with no errors
- [ ] All 6 PRs: Test coverage >80%
- [ ] All 6 PRs: All tests passing
- [ ] All 6 PRs: 100% type coverage (no unjustified `any`)

### Time Metrics
- **Sequential:** 290-380 minutes (4.8-6.3 hours)
- **2 Agents:** 150-195 minutes (2.5-3.25 hours)
- **3 Agents:** 105-135 minutes (1.75-2.25 hours)
- **6 Agents:** 60-75 minutes (1.0-1.25 hours) âœ…

### File Creation Count
- **Implementation files:** 18 (6 skyfi/*.ts + 6 types/*.ts + 6 schemas/*.ts)
- **Support files:** 2 (delivery-validator.ts, pricing-calculator.ts)
- **Test files:** 18 (6 unit test files + 6 integration test files + 2 lib test files)
- **Total new files:** 38

### Test Count (Estimated)
- PR-007: 70+ tests
- PR-008: 100+ tests (includes delivery validator)
- PR-009: 65+ tests
- PR-010: 65+ tests
- PR-011: 65+ tests
- PR-012: 70+ tests (includes pricing calculator)
- **Total new tests:** ~435 tests

---

## ðŸ“š Reference Documentation

### SkyFi API Documentation
- OpenAPI Spec: `docs/openapi.json`
- Official Pricing: https://skyfi.com/files/SkyFi_Pricing_2025.pdf
- Platform API Base: https://app.skyfi.com/platform-api

### Internal Documentation
- Task List: `docs/task-list.md`
- PRD: `docs/prd.md`
- Types: `src/types/skyfi-api.ts`
- Schemas: `src/schemas/skyfi.schemas.ts`
- Coding Standards: `.claude/rules/coding-standards.md`

### Key Concepts
- **AOI (Area of Interest):** Geographic polygon defining imagery region (WKT format)
- **WKT (Well-Known Text):** Standard format for geometric data (e.g., POLYGON(...))
- **Archive Order:** Order for existing satellite imagery
- **Tasking Order:** Order for new satellite captures
- **Feasibility:** Analysis of whether a tasking request can be fulfilled
- **Pass Prediction:** Forecasting when satellites will be over an AOI
- **Provider Window ID:** UUID from Planet for specific satellite pass opportunities
- **GSD (Ground Sample Distance):** Resolution in meters (smaller = higher resolution)

---

**Last Updated:** 2025-11-15
**Ready for Implementation:** âœ… YES - All 6 PRs can start in parallel
**File Conflicts:** 0 âœ…
**Estimated Total Time (Sequential):** 290-380 minutes
**Estimated Total Time (6 Agents Parallel):** 60-75 minutes âœ…
